<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>秘钥字典：文字 &lt;-&gt; 编号（网页版）</title>

  <!-- 手机上按真实宽度渲染 -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      margin: 0;
      padding: 0;
      background: #121212;
      color: #E6E6E6;
      font-family: "Microsoft YaHei", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      font-size: 16px;
    }
    .panel {
      max-width: 1100px;
      margin: 0 auto;
      padding: 16px;
    }
    h1 {
      font-size: 20px;
      margin: 0 0 8px 0;
    }
    label {
      display: inline-block;
      margin-right: 8px;
    }
    input[type="text"],
    input[type="password"] {
      background: #1E1E1E;
      color: #FFFFFF;
      border: 1px solid #333333;
      border-radius: 8px;
      padding: 6px 10px;
      font-size: 14px;
    }
    input[type="text"]:focus,
    input[type="password"]:focus,
    textarea:focus {
      outline: none;
      border-color: #2A82DA;
    }
    textarea {
      width: 100%;
      min-height: 160px;
      resize: vertical;
      background: #1E1E1E;
      color: #FFFFFF;
      border: 1px solid #333333;
      border-radius: 8px;
      padding: 8px;
      box-sizing: border-box;
      font-size: 14px;
      line-height: 1.5;
      font-family: Consolas, "Microsoft YaHei", monospace;
    }
    .row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      flex-wrap: wrap;
    }
    .row .grow {
      flex: 1;
      min-width: 150px;
    }
    .info {
      margin: 6px 0 12px;
      color: #CFCFCF;
      white-space: pre-line;
    }
    button {
      background: #2A2A2A;
      color: #E6E6E6;
      border: 1px solid #3A3A3A;
      border-radius: 10px;
      padding: 8px 14px;
      font-size: 14px;
      cursor: pointer;
    }
    button:hover {
      background: #3A3A3A;
    }
    button:active {
      background: #444444;
    }
    button:disabled {
      opacity: 0.4;
      cursor: default;
    }
    .section-title {
      margin: 10px 0 4px;
      font-weight: bold;
    }

    /* 顶部 Tab（字典界面） */
    .tabs {
      display: flex;
      margin-bottom: 12px;
      border-bottom: 1px solid #333333;
    }
    .tab-btn {
      padding: 8px 16px;
      border: none;
      border-radius: 10px 10px 0 0;
      margin-right: 8px;
      background: #1E1E1E;
      color: #AAAAAA;
      cursor: pointer;
    }
    .tab-btn.active {
      background: #2A2A2A;
      color: #FFFFFF;
      border-bottom: 2px solid #2A82DA;
    }
    .view-container {
      display: none;
    }
    .view-container.active {
      display: block;
    }

    /* 一键伪装按钮样式（单独的 class，避免被当成 Tab） */
    .fake-btn {
      margin-left: auto;
      padding: 6px 12px;
      border-radius: 8px;
      background: #1E1E1E;
      color: #AAAAAA;
      border: 1px solid #333333;
      cursor: pointer;
      font-size: 13px;
    }
    .fake-btn:hover {
      background: #2A2A2A;
    }
    .fake-btn:active {
      background: #333333;
    }

    /* 手机版字典布局 */
    .mobile-layout textarea {
      min-height: 140px;
    }
    .mobile-layout .row-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
    }
    .mobile-layout .row-buttons button {
      flex: 1 1 48%;
      height: 48px;
    }
    .mobile-layout .row-top {
      flex-direction: column;
      align-items: stretch;
    }
    .mobile-layout input[type="password"] {
      width: 100%;
    }

    /* 计算器布局 */
    #gateView {
      margin-top: 8px;
    }
    .calc-header-title {
      font-size: 18px;
      margin-bottom: 4px;
    }
    .calc-header-sub {
      font-size: 13px;
      color: #BBBBBB;
    }
    .calc-display {
      margin-top: 16px;
      background: #1E1E1E;
      border-radius: 8px;
      padding: 12px;
      text-align: right;
      font-size: 26px;
      min-height: 40px;
      box-sizing: border-box;
    }
    .calc-grid {
      margin-top: 16px;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
    }
    .calc-grid button {
      height: 52px;
      font-size: 18px;
    }
    .calc-equal {
      grid-column: 1 / span 4;
    }

    /* 意见反馈弹窗 */
    .dialog-mask {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }
    .dialog {
      background: #1E1E1E;
      border-radius: 12px;
      padding: 16px;
      max-width: 480px;
      width: 90%;
      box-sizing: border-box;
    }
    .dialog-title {
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 8px;
    }
    .dialog-body p {
      margin: 0 0 8px;
      font-size: 14px;
      color: #DDDDDD;
    }
    .dialog-body textarea {
      width: 100%;
      min-height: 80px;
      background: #000000;
      color: #FFFFFF;
      border: 1px solid #444444;
      border-radius: 8px;
      padding: 6px;
      box-sizing: border-box;
      font-size: 14px;
      resize: vertical;
    }
    .dialog-actions {
      margin-top: 12px;
      display: flex;
      justify-content: flex-end;
      gap: 8px;
    }

    @media (max-width: 768px) {
      .panel {
        padding: 12px;
      }
    }
  </style>
</head>
<body>
<div class="panel">
  <!-- 标题默认隐藏，解锁后再显示 -->
  <h1 id="mainTitle" style="display:none;">秘钥字典：文字 &lt;-&gt; 编号</h1>

  <!-- 计算器伪装界面（前置） -->
  <div id="gateView">
    <div class="calc-header">
      <div class="calc-header-title">计算器</div>
      <div class="calc-header-sub">一个简单的计算器</div>
    </div>
    <div id="gateDisplay" class="calc-display">0</div>
    <div id="gateInfo" class="info"></div>

    <div class="calc-grid">
      <button class="calc-btn" data-type="digit" data-val="7">7</button>
      <button class="calc-btn" data-type="digit" data-val="8">8</button>
      <button class="calc-btn" data-type="digit" data-val="9">9</button>
      <button class="calc-btn" data-type="op" data-val="÷">÷</button>

      <button class="calc-btn" data-type="digit" data-val="4">4</button>
      <button class="calc-btn" data-type="digit" data-val="5">5</button>
      <button class="calc-btn" data-type="digit" data-val="6">6</button>
      <button class="calc-btn" data-type="op" data-val="×">×</button>

      <button class="calc-btn" data-type="digit" data-val="1">1</button>
      <button class="calc-btn" data-type="digit" data-val="2">2</button>
      <button class="calc-btn" data-type="digit" data-val="3">3</button>
      <button class="calc-btn" data-type="op" data-val="-">-</button>

      <button class="calc-btn" data-type="digit" data-val="0">0</button>
      <button class="calc-btn" data-type="digit" data-val=".">.</button>
      <button class="calc-btn" data-type="clear">C</button>
      <button class="calc-btn" data-type="op" data-val="+">+</button>

      <button class="calc-btn calc-equal" data-type="equal">=</button>
    </div>
  </div>

  <!-- 真正的字典界面（解锁后显示） -->
  <div id="appView" style="display:none;">

    <div class="tabs">
      <button class="tab-btn active" data-target="desktopView">电脑版</button>
      <button class="tab-btn" data-target="mobileView">手机版</button>
      <!-- 一键伪装：单独 class，避免被 Tab 脚本当成切换按钮 -->
      <button id="btnFake" class="fake-btn">一键伪装</button>
    </div>

    <!-- 电脑版 -->
    <div id="desktopView" class="view-container active">
      <div class="row">
        <label for="keyInputDesktop">秘钥：</label>
        <input id="keyInputDesktop" type="password" class="grow"
               placeholder="同秘钥跨设备编号一致；不同秘钥完全不同" />
        <button id="loadBtnDesktop">加载字典</button>
      </div>
      <div id="infoDesktop" class="info">
        字典未加载，请先输入秘钥并点击【加载字典】
      </div>

      <div class="row">
        <label for="sepInputDesktop">编号分隔符（默认空格）：</label>
        <input id="sepInputDesktop" type="text" value=" " style="width: 80px;" />
      </div>

      <div class="section-title">输入（任意文字或编号序列）：</div>
      <textarea id="inputDesktop"
                placeholder="先加载字典，然后输入任意文本（含空格/标点）或编号序列"></textarea>

      <div class="section-title">输出：</div>
      <textarea id="outputDesktop" readonly></textarea>

      <div class="row" style="margin-top: 8px;">
        <button id="btnText2IdDesktop" disabled>文字 → 编号</button>
        <button id="btnId2TextDesktop" disabled>编号 → 文字</button>
        <span class="grow"></span>
        <button id="btnCopyDesktop" disabled>复制输出</button>
        <button id="btnClearDesktop" disabled>清空</button>
      </div>
    </div>

    <!-- 手机版 -->
    <div id="mobileView" class="view-container mobile-layout">
      <div class="row row-top">
        <div style="margin-bottom:6px;">
          <div style="font-weight:bold;">秘钥字典（手机版）</div>
          <div style="font-size:12px;color:#BBBBBB;">同秘钥，编号跨设备一致；不同秘钥不同。</div>
        </div>
        <input id="keyInputMobile" 输入="password"
               placeholder="输入秘钥..." />
        <div style="margin-top:6px;display:flex;gap:8px;">
          <button id="loadBtnMobile" style="flex:1;">加载字典</button>
        </div>
      </div>
      <div id="infoMobile" class="info">
        字典未加载，请先输入秘钥并点击【加载字典】
      </div>

      <div class="row">
        <label for="sepInputMobile">编号分隔符：</label>
        <input id="sepInputMobile" type="text" value=" " style="width: 80px;" />
        <span style="font-size:12px;color:#888888;">空则默认为空格</span>
      </div>

      <div class="section-title">输入</div>
      <textarea id="inputMobile"
                placeholder="输入任意文字（含空格/标点）或编号序列"></textarea>

      <div class="section-title">输出</div>
      <textarea id="outputMobile" readonly></textarea>

      <div class="row-buttons">
        <button id="btnText2IdMobile" disabled>文字 → 编号</button>
        <button id="btnId2TextMobile" disabled>编号 → 文字</button>
        <button id="btnCopyMobile" disabled>复制输出</button>
        <button id="btnClearMobile" disabled>清空</button>
      </div>
    </div>
  </div>
</div>

<!-- 弹窗 -->
<div id="feedbackMask" class="dialog-mask">
  <div class="dialog">
    <div class="dialog-title">意见反馈</div>
    <div class="dialog-body">
      <p>欢迎反馈使用体验或建议。</p>
      <textarea id="feedbackText" placeholder="在此输入反馈内容"></textarea>
    </div>
    <div class="dialog-actions">
      <button id="feedbackCancel">取消</button>
      <button id="feedbackSubmit">提交</button>
    </div>
  </div>
</div>

<!-- ============ Script 1：只负责“计算器 + 解锁 + 弹窗” ============ -->
<script>
  (function () {
    var PIN_KEY = "secret_pin";

    var gateDisplayEl = document.getElementById("gateDisplay");
    var gateInfoEl = document.getElementById("gateInfo");
    var feedbackMask = document.getElementById("feedbackMask");
    var feedbackText = document.getElementById("feedbackText");
    var feedbackCancel = document.getElementById("feedbackCancel");
    var feedbackSubmit = document.getElementById("feedbackSubmit");

    var calcDisplay = "0";
    var calcExpr = "";
    var calcInfo = "";
    var secretModeActive = false;
    var secretEqualCount = 0;

    function renderCalc() {
      gateDisplayEl。textContent = calcDisplay;
      gateInfoEl。textContent = calcInfo || "";
    }

    function resetSecret() {
      secretModeActive = false;
      secretEqualCount = 0;
    }

    function onClear() {
      calcDisplay = "0";
      calcExpr = "";
      calcInfo = "";
      resetSecret();
      renderCalc();
    }

    function onDigit(d) {
      if (calcDisplay === "0" || calcDisplay === "错误" || calcDisplay === "完成") {
        calcDisplay = d;
      } else {
        calcDisplay += d;
      }
      calcExpr += d;
      calcInfo = "";
      resetSecret();
      renderCalc();
    }

    function onOp(op) {
      if (!calcExpr) return;
      var last = calcExpr。charAt(calcExpr。length - 1);
      if ("+-×÷"。indexOf(last) !== -1) {
        calcExpr = calcExpr。slice(0, -1) + op;
      } else {
        calcExpr += op;
      }
      calcDisplay = calcExpr;
      calcInfo = "";
      resetSecret();
      renderCalc();
    }

    function evalExpressionSimple(expr) {
      if (!expr || !expr.trim()) return "0";
      var cleaned = expr.replace(/ /g, "");
      var nums = [];
      var ops = [];
      var current = "";

      for (var i = 0; i < cleaned.length; i++) {
        var ch = cleaned.charAt(i);
        if ((ch >= "0" && ch <= "9") || ch === ".") {
          current += ch;
        } else if ("+-×÷".indexOf(ch) !== -1) {
          if (!current) return null;
          var v = Number(current);
          if (!isFinite(v)) return null;
          nums.push(v);
          ops.push(ch);
          current = "";
        } else {
          return null;
        }
      }
      if (current) {
        var v2 = Number(current);
        if (!isFinite(v2)) return null;
        nums.push(v2);
      }
      if (!nums.length) return null;

      var result = nums[0];
      for (var j = 0; j < ops.length; j++) {
        var b = nums[j + 1];
        if (typeof b === "undefined") return null;
        var op2 = ops[j];
        if (op2 === "+") result += b;
        else if (op2 === "-") result -= b;
        else if (op2 === "×") result *= b;
        else if (op2 === "÷") {
          if (b === 0) return null;
          result /= b;
        }
      }
      var asLong = Math.trunc(result);
      return result === asLong ? String(asLong) : String(result);
    }

    function showApp() {
      var gate = document.getElementById("gateView");
      var app = document.getElementById("appView");
      var title = document.getElementById("mainTitle");
      if (gate) gate.style.display = "none";
      if (app) app.style.display = "block";
      if (title) title.style.display = "block";
    }

    // 一键伪装：回到计算器界面，隐藏标题和字典
    function showCalc() {
      var gate = document.getElementById("gateView");
      var app = document.getElementById("appView");
      var title = document.getElementById("mainTitle");
      if (gate) gate.style.display = "block";
      if (app) app.style.display = "none";
      if (title) title.style.display = "none";
    }

    function openFeedbackDialog() {
      feedbackText.value = "";
      feedbackMask.style.display = "flex";
    }

    function closeFeedbackDialog() {
      feedbackMask.style.display = "none";
    }

    feedbackCancel.addEventListener("click", function () {
      closeFeedbackDialog();
    });

    feedbackSubmit.addEventListener("click", function () {
      var trimmed = feedbackText。value。替换(/^\s+|\s+$/g， "");
      var isDigitsOnly = trimmed。length > 0 && /^[0-9]+$/。test(trimmed);

      if (isDigitsOnly) {
        try {
          window.localStorage.setItem(PIN_KEY, trimmed);
        } catch (e) {}
        calcInfo = "反馈已提交。";
      } else {
        calcInfo = "反馈已提交。";
      }
      renderCalc();
      closeFeedbackDialog();
    });

    function onEqual() {
      var exprBefore = calcExpr;
      var currentPin = null;
      try {
        currentPin = window.localStorage.getItem(PIN_KEY);
      } catch (e) {}

      // 1) 解锁
      if (currentPin && exprBefore === currentPin) {
        calcDisplay = "完成";
        calcInfo = "已解锁";
        calcExpr = "";
        resetSecret();
        renderCalc();
        showApp();
        return;
      }

      // 2) 隐藏入口：1+1 + 连续按 20 次 "="
      if (!secretModeActive) {
        if (exprBefore === "1+1") {
          secretModeActive = true;
          secretEqualCount = 1;
        }
      } else {
        secretEqualCount += 1;
      }

      if (secretModeActive && secretEqualCount >= 20) {
        openFeedbackDialog();
        resetSecret();
      }

      // 3) 正常计算
      var res = evalExpressionSimple(exprBefore);
      if (res !== null) {
        calcDisplay = res;
        calcExpr = res;
        calcInfo = "";
      } else {
        calcDisplay = "错误";
        calcInfo = "无效表达式";
      }
      renderCalc();
    }

    // 绑定按钮
    var btns = document。querySelectorAll(".calc-btn");
    for (var k = 0; k < btns.length; k++) {
      (function (btn) {
        var type = btn.getAttribute("data-type");
        var val = btn.getAttribute("data-val") || "";
        btn。addEventListener("click"， function () {
          if (type === "digit") onDigit(val);
          else if (type === "op") onOp(val);
          else if (type === "clear") onClear();
          else if (type === "equal") onEqual();
        });
      })(btns[k]);
    }

    // 暴露给外部的“一键伪装”接口
    window.fakeLockToCalc = function () {
      calcDisplay = "0";
      calcExpr = "";
      calcInfo = "";
      resetSecret();
      renderCalc();
      showCalc();
    };

    renderCalc();
  })();
</script>

<!-- ============ Script 2：字典 / SplitMix64 / Tab（和计算器独立） ============ -->
<script>
  (function () {
    // 顶部 Tab 自动识别设备
    function initTabs() {
      var tabButtons = document.querySelectorAll(".tab-btn");
      var views = document.querySelectorAll(".view-container");

      var isMobile =
        /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile/i.test(navigator.userAgent) ||
        window.innerWidth <= 768;

      var defaultTarget = isMobile ? "mobileView" : "desktopView";

      tabButtons.forEach(function (btn) {
        var target = btn.getAttribute("data-target");
        if (target === defaultTarget) {
          btn.classList.add("active");
        } else {
          btn.classList.remove("active");
        }
      });
      views.forEach(function (view) {
        if (view.id === defaultTarget) {
          view.classList.add("active");
        } else {
          view.classList.remove("active");
        }
      });

      tabButtons.forEach(function (btn) {
        btn.addEventListener("click", function () {
          var target = btn.getAttribute("data-target");
          tabButtons.forEach(function (b) { b.classList.remove("active"); });
          views.forEach(function (v) { v.classList.remove("active"); });

          btn.classList.add("active");
          document.getElementById(target).classList.add("active");
        });
      });
    }

    initTabs();

    // 一键伪装按钮：调用计算器脚本里的 fakeLockToCalc
    var fakeBtn = document.getElementById("btnFake");
    if (fakeBtn) {
      fakeBtn.addEventListener("click", function () {
        if (window.fakeLockToCalc) {
          window.fakeLockToCalc();
        }
      });
    }

    // ===== 固定字符全集 & SplitMix64 =====
    function fixedCharset() {
      var chars = [];
      chars.push("\n");
      chars.push("\r");
      chars.push("\t");
      for (var i = 0x20; i < 0x7F; i++) {
        chars.push(String.fromCharCode(i));
      }
      for (var j = 0xFF01; j < 0xFF5F; j++) {
        chars.push(String.fromCharCode(j));
      }
      chars.push("\u3000");
      var punct = "，。、！？；：‘’“”【】（）《》〈〉——…·「」『』￥％＃＠＆＋－＝／＼｜～｀";
      for (var p = 0; p < punct.length; p++) {
        chars.push(punct[p]);
      }
      for (var a = 0x4E00; a < 0xA000; a++) {
        chars.push(String.fromCharCode(a));
      }
      for (var b = 0x3400; b < 0x4DC0; b++) {
        chars.push(String.fromCharCode(b));
      }
      for (var c = 0x2600; c < 0x27C0; c++) {
        chars.push(String.fromCharCode(c));
      }
      var seen = {};
      var out = [];
      for (var idx = 0; idx < chars.length; idx++) {
        var ch = chars[idx];
        if (!seen[ch]) {
          seen[ch] = true;
          out.push(ch);
        }
      }
      return out;
    }

    var CHARSET_FIXED = fixedCharset();
    var MASK64 = (1n << 64n) - 1n;

    function SplitMix64(seed) {
      this.state = seed & MASK64;
    }
    SplitMix64.prototype.nextU64 = function () {
      this.state = (this.state + 0x9e3779b97f4a7c15n) & MASK64;
      var z = this.state;
      z = (z ^ (z >> 30n)) * 0xbf58476d1ce4e5b9n & MASK64;
      z = (z ^ (z >> 27n)) * 0x94d049bb133111ebn & MASK64;
      z = z ^ (z >> 31n);
      return z & MASK64;
    };
    SplitMix64.prototype.nextBounded = function (bound) {
      var x = this.nextU64();
      return Number(x % BigInt(bound));
    };

    async function sha256ToSeedU64(key) {
      var enc = new TextEncoder();
      var data = enc.encode(key.trim());
      if (!window.crypto || !window.crypto.subtle) {
        throw new Error("当前浏览器不支持 crypto.subtle，请在 HTTPS 环境下使用最新版浏览器。");
      }
      var hashBuf = await window.crypto.subtle.digest("SHA-256", data);
      var hash = new Uint8Array(hashBuf);
      var seed = 0n;
      for (var i = 0; i < 8; i++) {
        seed = (seed << 8n) | BigInt(hash[i]);
      }
      return seed & MASK64;
    }

    async function charsetFromKey(key) {
      key = key.trim();
      if (!key) throw new Error("秘钥不能为空");
      var seed = await sha256ToSeedU64(key);
      var rng = new SplitMix64(seed);
      var shuffled = CHARSET_FIXED.slice();
      for (var i = shuffled.length - 1; i > 0; i--) {
        var j = rng.nextBounded(i + 1);
        var tmp = shuffled[i];
        shuffled[i] = shuffled[j];
        shuffled[j] = tmp;
      }
      return shuffled;
    }

    // ===== 字典界面状态 =====
    var shuffled = null;
    var id2char = null;
    var char2id = null;

    function enableView(prefix, enabled) {
      ["btnText2Id", "btnId2Text", "btnCopy", "btnClear"].forEach(function (id) {
        var el = document.getElementById(id + prefix);
        if (el) el.disabled = !enabled;
      });
    }

    function getSep(prefix) {
      var el = document.getElementById("sepInput" + prefix);
      if (!el) return " ";
      var v = el.value;
      return v === "" ? " " : v;
    }

    function updateInfoAll(text) {
      var d = document.getElementById("infoDesktop");
      var m = document.getElementById("infoMobile");
      if (d) d.textContent = text;
      if (m) m.textContent = text;
    }

    function setDictLoadedUI() {
      var size = shuffled ? shuffled.length : 0;
      var msg =
        "字典已加载 ✅  | 字符全集大小：" + size +
        "\n同秘钥跨设备编号完全一致；不同秘钥编号体系完全不同。";
      updateInfoAll(msg);
      enableView("Desktop", true);
      enableView("Mobile", true);
    }

    function setErrorUI(msg) {
      updateInfoAll("[错误] " + msg);
      enableView("Desktop", false);
      enableView("Mobile", false);
    }

    function initView(prefix) {
      var keyInput   = document.getElementById("keyInput" + prefix);
      var loadBtn    = document.getElementById("loadBtn" + prefix);
      var inputArea  = document.getElementById("input" + prefix);
      var outputArea = document.getElementById("output" + prefix);
      var btnT2I     = document.getElementById("btnText2Id" + prefix);
      var btnI2T     = document.getElementById("btnId2Text" + prefix);
      var btnCopy    = document.getElementById("btnCopy" + prefix);
      var btnClear   = document.getElementById("btnClear" + prefix);

      enableView(prefix, false);

      if (loadBtn) {
        loadBtn.addEventListener("click", async function () {
          var key = keyInput ? keyInput.value : "";
          if (!key.trim()) {
            setErrorUI("秘钥不能为空");
            return;
          }
          loadBtn.disabled = true;
          updateInfoAll("正在根据秘钥生成字典，请稍候……");
          try {
            shuffled = await charsetFromKey(key);
            id2char = shuffled;
            char2id = new Map();
            for (var i = 0; i < shuffled.length; i++) {
              char2id.set(shuffled[i], i + 1);
            }
            setDictLoadedUI();
          } catch (e) {
            console.error(e);
            setErrorUI(e && e.message ? e.message : String(e));
          } finally {
            loadBtn.disabled = false;
          }
        });
      }

      if (btnT2I) {
        btnT2I.addEventListener("click", function () {
          if (!char2id) {
            outputArea.value = "请先输入秘钥并加载字典。";
            return;
          }
          var text = inputArea.value;
          var sep = getSep(prefix);
          var ids = [];
          var missing = [];
          for (var i = 0; i < text.length; i++) {
            var ch = text[i];
            if (char2id.has(ch)) ids.push(String(char2id.get(ch)));
            else missing.push(ch);
          }
          var out = ids.join(sep);
          if (missing.length > 0) {
            out += "\n\n[提示] 下列字符不在固定全集中，无法编码：\n" + missing.join("");
          }
          outputArea.value = out;
        });
      }

      if (btnI2T) {
        btnI2T.addEventListener("click", function () {
          if (!id2char) {
            outputArea.value = "请先输入秘钥并加载字典。";
            return;
          }
          var raw = inputArea。value。trim();
          if (!raw) {
            outputArea.value = "";
            return;
          }
          var parts = raw.split(/[,\s;、，；]+/);
          var n = id2char.length;
          var outChars = [];
          var bad = [];
          parts。forEach(function (p) {
            if (!p) return;
            var num = Number.parseInt(p, 10);
            if (!Number。isFinite(num)) {
              bad。push(p);
              return;
            }
            if (num >= 1 && num <= n) outChars.push(id2char[num - 1]);
            else bad。push(p);
          });
          var textOut = outChars.join("");
          if (bad.length > 0) {
            textOut += "\n\n[提示] 无效/超范围编号已忽略：\n" + JSON.stringify(bad, null, 2);
          }
          outputArea.value = textOut;
        });
      }

      if (btnCopy) {
        btnCopy.addEventListener("click"， async function () {
          try {
            await navigator.clipboard.writeText(outputArea.value || "");
            alert("输出内容已复制到剪贴板。");
          } catch (e) {
            console.error(e);
            alert("复制失败，请手动 Ctrl+C。");
          }
        });
      }

      if (btnClear) {
        btnClear.addEventListener("click", function () {
          inputArea.value = "";
          outputArea.value = "";
        });
      }
    }

    initView("Desktop");
    initView("Mobile");
  })();
</script>
</body>
</html>
